# CRBench (Code Review Benchmark)

ç”¨äºè¯„ä¼° AI ä»£ç è¯„å®¡ç³»ç»Ÿèƒ½åŠ›çš„æ ‡å‡†åŒ–æµ‹è¯•é›†ã€‚

## ğŸ“Š æµ‹è¯•é›†æ¦‚è§ˆ

**ç‰¹ç‚¹**ï¼š
- **æ€»ç”¨ä¾‹æ•°**: 36ä¸ªï¼ˆç²¾ç®€é«˜æ•ˆï¼‰
- **ç»“æ„å¹³è¡¡**: 7ä¸ªç»´åº¦ï¼Œæ¯ä¸ªç»´åº¦è‡³å°‘åŒ…å« **2ä¸ªåä¾‹** (Bug) + **2ä¸ªæ­£ä¾‹** (Trap)ã€‚
- **é«˜åŒºåˆ†åº¦**:
    - **åä¾‹ (Negative)**: åŒ…å«çœŸå®æ¼æ´ï¼ˆSQLæ³¨å…¥ã€è¶Šæƒã€NPEç­‰ï¼‰ï¼Œé¢„æœŸåº”æ£€å‡ºã€‚
    - **æ­£ä¾‹ (Trap)**: çœ‹èµ·æ¥åƒé—®é¢˜ä½†å®é™…åˆç†çš„ä»£ç ï¼ˆå¦‚Builderæ¨¡å¼ã€Fail-Fastã€ç½‘å…³é‰´æƒï¼‰ï¼Œé¢„æœŸ**ä¸åº”æ£€å‡º**ã€‚
- **æ— è¯±å¯¼**: æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å‡å·²å»é™¤äº†è¯±å¯¼æ€§æ³¨é‡Šï¼Œæ¨¡æ‹ŸçœŸå®æ— æ³¨é‡Šä»£ç ç¯å¢ƒã€‚

## ğŸ¯ æµ‹è¯•ç»´åº¦åˆ†å¸ƒ

| ç»´åº¦ | åä¾‹ (åº”æŠ¥è­¦) | æ­£ä¾‹ (Trap-ä¸åº”æŠ¥è­¦) | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **Q01_Functionality** | 2 | 4 | NPEã€èµ„æºæ³„æ¼ vs Fail-Fastã€å¼‚å¸¸å¤„ç† |
| **Q02_Security** | 5 | 4 | æ³¨å…¥ã€XSS vs ç™½åå•ã€è„±æ• |
| **Q03_BestPractices** | 2 | 2 | é­”æ³•å€¼ã€åå¼‚å¸¸ vs é¢„æœŸå¼‚å¸¸ã€Builderæ¨¡å¼ |
| **Q04_Performance** | 2 | 2 | N+1ã€å¾ªç¯æ‹¼æ¥ vs åŒé‡æ£€æŸ¥é”ã€é™æµSleep |
| **Q05_CodeStyle** | 2 | 2 | æ‹¼éŸ³å‘½åã€é•¿æ–¹æ³• vs LambdaçŸ­å˜é‡ã€é˜²æ—¶åºæ”»å‡» |
| **Q06_HorizontalPrivilege** | 3 | 2 | IDORæ¼æ´ vs ç®¡ç†å‘˜æƒé™ã€å…±äº«æ•°æ® |
| **Q07_VerticalPrivilege** | 2 | 2 | è¶Šæƒè®¿é—® vs å…¬å¼€æ¥å£ã€ç½‘å…³é‰´æƒ |
| **æ€»è®¡** | **18** | **18** | **36ä¸ªç”¨ä¾‹** |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®

ç¼–è¾‘ `tests/benchmark_config.py` é…ç½® LLMï¼š

```python
LLM_API_KEY = "your-key"
REVIEW_MODEL = "qwen/qwen3-coder-30b-a3b-instruct"
MAX_WORKERS = 10  # å¹¶å‘æ•°
```

### 2. è¿è¡Œ

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ
python tests/run_benchmark.py --all
```

### 3. è§£è¯»ç»“æœ

æŠ¥å‘Šå°†ä¿å­˜åœ¨ `tests/results/benchmark_TIMESTAMP.json`ã€‚

**å…³é”®æŒ‡æ ‡**ï¼š
- **å‡†ç¡®ç‡ (Precision)**: æ£€å‡ºçš„é—®é¢˜ä¸­æœ‰å¤šå°‘æ˜¯çœŸé—®é¢˜ï¼Ÿ
    - *åŸºå‡†å€¼*: ~50-60%ã€‚(å› ä¸º Trap ç”¨ä¾‹å¾ˆå®¹æ˜“å¯¼è‡´è¯¯æŠ¥)
    - *ç›®æ ‡*: > 70%ã€‚
- **å¬å›ç‡ (Recall)**: çœŸé—®é¢˜æ£€å‡ºäº†å¤šå°‘ï¼Ÿ
    - *åŸºå‡†å€¼*: > 80%ã€‚
    - *ç›®æ ‡*: > 90%ã€‚

**æ··æ·†çŸ©é˜µ**ï¼š
- **TP (True Positive)**: æ­£ç¡®æ£€å‡ºåä¾‹ã€‚
- **FP (False Positive)**: è¯¯æŠ¥äº†æ­£ä¾‹ (Trap)ã€‚*è¿™æ˜¯ä¼˜åŒ–çš„é‡ç‚¹ã€‚*
- **FN (False Negative)**: æ¼æŠ¥äº†åä¾‹ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ QXX_DimensionName/            # æµ‹è¯•ç”¨ä¾‹ç›®å½•
â”‚   â”œâ”€â”€ negativeXXX_Name/ # åä¾‹ (Negative - åº”æŠ¥è­¦)
â”‚   â””â”€â”€ positiveXXX_Name/ # æ­£ä¾‹ (Positive - ä¸åº”æŠ¥è­¦)
â”œâ”€â”€ run_benchmark.py      # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_review_benchmark.py # æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ benchmark_config.py   # é…ç½®æ–‡ä»¶
â””â”€â”€ results/              # æµ‹è¯•æŠ¥å‘Š
```
