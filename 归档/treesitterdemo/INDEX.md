# Tree-sitter è°ƒç”¨é“¾åˆ†æå·¥å…· - å®Œæ•´ç´¢å¼•

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
treesitterdemo/
â”œâ”€â”€ ğŸ“– INDEX.md                      # æœ¬æ–‡ä»¶ - é¡¹ç›®ç´¢å¼•
â”œâ”€â”€ ğŸš€ å¿«é€Ÿå¼€å§‹.md                   # å¿«é€Ÿå…¥é—¨æŒ‡å—
â”œâ”€â”€ ğŸ“‹ æ€»ç»“.md                       # é¡¹ç›®æ€»ç»“å’Œå»ºè®®
â”œâ”€â”€ ğŸ“š README.md                     # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ callchain_analyzer.py        # Tree-sitter å®ç° V1
â”œâ”€â”€ ğŸ callchain_analyzer_v2.py     # Tree-sitter å®ç° V2ï¼ˆæ”¹è¿›ç‰ˆï¼‰
â”œâ”€â”€ ğŸ debug_parser.py              # è°ƒè¯•å·¥å…·
â”‚
â”œâ”€â”€ ğŸ”§ install.sh                   # è‡ªåŠ¨å®‰è£…è„šæœ¬
â””â”€â”€ ğŸ”§ run.sh                       # ä¸€é”®è¿è¡Œè„šæœ¬
```

## ğŸ“– æ–‡æ¡£é˜…è¯»é¡ºåº

### 1ï¸âƒ£ å¦‚æœä½ æƒ³å¿«é€Ÿä½¿ç”¨
ğŸ‘‰ é˜…è¯»ï¼š[å¿«é€Ÿå¼€å§‹.md](å¿«é€Ÿå¼€å§‹.md)

### 2ï¸âƒ£ å¦‚æœä½ æƒ³äº†è§£è¯¦ç»†åŠŸèƒ½
ğŸ‘‰ é˜…è¯»ï¼š[README.md](README.md)

### 3ï¸âƒ£ å¦‚æœä½ æƒ³äº†è§£é¡¹ç›®ç»“è®º
ğŸ‘‰ é˜…è¯»ï¼š[æ€»ç»“.md](æ€»ç»“.md)

---

## ğŸ¯ æ ¸å¿ƒç»“è®ºï¼ˆTL;DRï¼‰

### å¯¹äº Java è°ƒç”¨é“¾åˆ†æï¼š

âœ… **æ¨èä½¿ç”¨ JavaParser**
- å‡†ç¡®ç‡ï¼š100%
- å·²å®Œç¾å®ç°ï¼š`../javaparsedemo/`
- æ˜“äºä½¿ç”¨å’Œç»´æŠ¤

âš ï¸ **Tree-sitter æœ‰å±€é™æ€§**
- å‡†ç¡®ç‡ï¼šçº¦ 70%
- Java å¤æ‚è¯­æ³•æ”¯æŒä¸å®Œå–„
- é€‚åˆå…¶ä»–åœºæ™¯ï¼ˆç¼–è¾‘å™¨ã€å¤šè¯­è¨€å·¥å…·ï¼‰

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤

### å®‰è£…ä¾èµ–
```bash
cd /Users/renzhibin/workspace/mydata/å®‰å…¨è¯„å®¡/treesitterdemo
./install.sh
```

### è¿è¡Œ Tree-sitter ç‰ˆæœ¬
```bash
python3 callchain_analyzer_v2.py
```

### è¿è¡Œ JavaParser ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
```bash
cd ../javaparsedemo
java -cp "target/classes:$(find ~/.m2 -name 'javaparser-core-*.jar' | head -1)" \
  com.security.analyzer.CallChainAnalyzer
```

---

## ğŸ“Š å·¥å…·å¯¹æ¯”è¡¨

| ç»´åº¦ | JavaParser â­ | Tree-sitter | Semgrep |
|------|---------------|-------------|---------|
| å‡†ç¡®ç‡ | â­â­â­â­â­ | â­â­â­ | â­â­ |
| æ˜“ç”¨æ€§ | â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| è°ƒç”¨é“¾ | âœ… å®Œç¾ | âš ï¸ æœ‰é™ | âŒ ä¸æ”¯æŒ |
| é€Ÿåº¦ | âš¡âš¡ | âš¡âš¡âš¡ | âš¡âš¡ |
| é€‚ç”¨åœºæ™¯ | Java æ·±åº¦åˆ†æ | ç¼–è¾‘å™¨/å¤šè¯­è¨€ | å¿«é€Ÿæ‰«æ |

---

## ğŸ“ ç›¸å…³é¡¹ç›®æ–‡ä»¶

### JavaParser å®ç°ï¼ˆæ¨èï¼‰
```
../javaparsedemo/
â””â”€â”€ src/main/java/com/security/analyzer/
    â”œâ”€â”€ SecurityAnalyzer.java       # å®‰å…¨åˆ†æå™¨
    â””â”€â”€ CallChainAnalyzer.java      # è°ƒç”¨é“¾åˆ†æå™¨ â­
```

### Semgrep è§„åˆ™
```
../springboot-vuln-demo/
â”œâ”€â”€ semgrep-idor-rules.yaml         # è¶Šæƒæ£€æµ‹è§„åˆ™
â”œâ”€â”€ semgrep-taint-analysis.yaml     # æ±¡ç‚¹åˆ†æè§„åˆ™
â””â”€â”€ SEMGREP_åˆ†ææŠ¥å‘Š.md             # åˆ†ææŠ¥å‘Š
```

---

## ğŸ› ï¸ å·²å®Œæˆçš„å·¥ä½œ

âœ… åˆ›å»º Tree-sitter Python åˆ†æå™¨
âœ… å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆtree-sitter, tree-sitter-javaï¼‰
âœ… å®ç°æ–¹æ³•å®šä¹‰æå–
âœ… å®ç°æ–¹æ³•è°ƒç”¨è¯†åˆ«
âœ… åˆ›å»ºå®Œæ•´æ–‡æ¡£
âœ… åˆ›å»ºå®‰è£…å’Œè¿è¡Œè„šæœ¬
âœ… æµ‹è¯•å’Œè°ƒè¯•
âœ… å¯¹æ¯”åˆ†æå’Œæ€»ç»“

---

## ğŸ’¡ å­¦åˆ°çš„ç»éªŒ

1. **é€‰å¯¹å·¥å…·å¾ˆé‡è¦**
   - JavaParser æ›´é€‚åˆ Java æ·±åº¦åˆ†æ
   - Tree-sitter æ›´é€‚åˆç¼–è¾‘å™¨å’Œå¤šè¯­è¨€å·¥å…·

2. **å®è·µå‡ºçœŸçŸ¥**
   - é€šè¿‡å®é™…æµ‹è¯•æ‰å‘ç°é—®é¢˜
   - ç†è®ºä¸Šå¯è¡Œä¸ä»£è¡¨å®é™…å¥½ç”¨

3. **æ²¡æœ‰å®Œç¾çš„å·¥å…·**
   - æ¯ä¸ªå·¥å…·éƒ½æœ‰å…¶æ“…é•¿çš„é¢†åŸŸ
   - æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·

---

## ğŸ“š å‚è€ƒèµ„æº

- [Tree-sitter å®˜æ–¹æ–‡æ¡£](https://tree-sitter.github.io/)
- [tree-sitter-java GitHub](https://github.com/tree-sitter/tree-sitter-java)
- [JavaParser å®˜æ–¹ç½‘ç«™](https://javaparser.org/)
- [Semgrep æ–‡æ¡£](https://semgrep.dev/docs/)

---

## ğŸ¤ ä¸‹ä¸€æ­¥å»ºè®®

### å¯¹äº springboot-vuln-demo åˆ†æï¼š

1. **ä½¿ç”¨ JavaParser è¿›è¡Œè°ƒç”¨é“¾åˆ†æ**
   ```bash
   cd ../javaparsedemo
   ./run-callchain.sh
   ```

2. **ä½¿ç”¨ Semgrep è¿›è¡Œå¿«é€Ÿæ‰«æ**
   ```bash
   cd ../springboot-vuln-demo
   semgrep --config=semgrep-idor-rules.yaml src/
   ```

3. **ç»“åˆä¸¤è€…ç”Ÿæˆå®Œæ•´æŠ¥å‘Š**
   - Semgrep æ‰¾å‡ºå¯ç–‘ä½ç½®
   - JavaParser è¿½è¸ªå®Œæ•´è°ƒç”¨é“¾
   - ç”Ÿæˆè¯¦ç»†çš„æ¼æ´åˆ†ææŠ¥å‘Š

---

## ğŸ“ ç‰ˆæœ¬å†å²

- **V1**: åˆå§‹å®ç°ï¼ˆæœ‰ bugï¼‰
- **V2**: æ”¹è¿›ç‰ˆæœ¬ï¼ˆä»æœ‰å±€é™æ€§ï¼‰
- **Final**: å®Œæ•´æ–‡æ¡£å’Œæ€»ç»“

---

## âœ‰ï¸ åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆï¼

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ
**çŠ¶æ€**: âœ… å®Œæˆ
**æ¨è**: ä½¿ç”¨ JavaParser è¿›è¡Œ Java è°ƒç”¨é“¾åˆ†æ

