# ä»£ç åˆ†æå·¥å…·å¯¹æ¯”ï¼šSemgrep vs JavaParser vs Tree-sitter

## ğŸ“Š å¿«é€Ÿå¯¹æ¯”è¡¨

| ç»´åº¦ | Semgrep | JavaParser | Tree-sitter |
|------|---------|------------|-------------|
| **å®šä½** | æ¨¡å¼åŒ¹é…æ‰«æå™¨ | Java ä¸“ç”¨åˆ†æå™¨ | é€šç”¨è¯­æ³•è§£æå™¨ |
| **å­¦ä¹ æ›²çº¿** | ğŸŸ¢ ç®€å•ï¼ˆå†™ YAMLï¼‰ | ğŸŸ¡ ä¸­ç­‰ï¼ˆJava APIï¼‰ | ğŸ”´ å›°éš¾ï¼ˆåº•å±‚ APIï¼‰ |
| **é€Ÿåº¦** | âš¡âš¡ å¿« | âš¡âš¡ å¿« | âš¡âš¡âš¡ è¶…å¿« |
| **è¯­è¨€æ”¯æŒ** | 30+ | ä»… Java | 40+ |
| **è°ƒç”¨é“¾åˆ†æ** | âŒ ä¸æ”¯æŒ | âœ… **å®¹æ˜“å®ç°** | âš ï¸ éœ€å¤§é‡ä»£ç  |
| **å®‰è£…** | `pip install semgrep` | Maven ä¾èµ– | å¤æ‚ï¼ˆéœ€ç¼–è¯‘è¯­æ³•ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å¿«é€Ÿå®‰å…¨æ‰«æ | Java æ·±åº¦åˆ†æ | ç¼–è¾‘å™¨/LSP |

---

## ğŸ¯ å…·ä½“å¯¹æ¯”

### 1ï¸âƒ£ **Semgrep - å®‰å…¨æ‰«æé¦–é€‰**

#### âœ… ä¼˜ç‚¹ï¼š
- **æœ€ç®€å•**ï¼šå†™å‡ è¡Œ YAML å°±èƒ½æ‰«æ
- **é€Ÿåº¦å¿«**ï¼šå‡ ç§’é’Ÿæ‰«å®Œæ•´ä¸ªé¡¹ç›®
- **è§„åˆ™ä¸°å¯Œ**ï¼šå®˜æ–¹æä¾› 2000+ å®‰å…¨è§„åˆ™
- **CI/CD å‹å¥½**ï¼šå®¹æ˜“é›†æˆåˆ°æµæ°´çº¿

#### âŒ ç¼ºç‚¹ï¼š
- **ä¸èƒ½è¿½è¸ªè°ƒç”¨é“¾**ï¼šåªèƒ½æ‰¾ç›´æ¥åŒ¹é…çš„ä»£ç 
- **è·¨æ–‡ä»¶åˆ†æå¼±**ï¼šéš¾ä»¥åˆ†ææ–¹æ³•é—´çš„è°ƒç”¨å…³ç³»
- **å®šåˆ¶åŒ–å›°éš¾**ï¼šå¤æ‚é€»è¾‘éœ€è¦å†™å¾ˆå¤æ‚çš„è§„åˆ™

#### ğŸ’¡ é€‚åˆåœºæ™¯ï¼š
```bash
âœ… å¿«é€Ÿå®‰å…¨æ‰«æï¼ˆIDORã€SQLæ³¨å…¥ã€XSSï¼‰
âœ… ä»£ç è§„èŒƒæ£€æŸ¥ï¼ˆä¸ä½¿ç”¨ System.out.printlnï¼‰
âœ… CI/CD è‡ªåŠ¨åŒ–æ‰«æ
âŒ ä¸é€‚åˆï¼šå®Œæ•´çš„è°ƒç”¨é“¾åˆ†æ
```

#### ä½¿ç”¨ç¤ºä¾‹ï¼š
```yaml
# ä¸€æ¡è§„åˆ™æ‰¾æ‰€æœ‰è¶Šæƒæ¼æ´
rules:
  - id: find-idor
    pattern: |
      @GetMapping(...)
      public $RET $METHOD(@PathVariable $TYPE $ID) { ... }
    message: å¯èƒ½å­˜åœ¨ IDOR æ¼æ´
```

---

### 2ï¸âƒ£ **JavaParser - Java åˆ†æçš„ç‹è€…** â­ æ¨è

#### âœ… ä¼˜ç‚¹ï¼š
- **ä¸“ä¸º Java è®¾è®¡**ï¼šç†è§£ Java è¯­æ³•å’Œè¯­ä¹‰
- **API å‹å¥½**ï¼šé¢å‘å¯¹è±¡ï¼Œå®¹æ˜“ä¸Šæ‰‹
- **åŠŸèƒ½å¼ºå¤§**ï¼šå¯ä»¥åšä»»ä½•ä½ æƒ³è¦çš„åˆ†æ
- **ç¤¾åŒºæ´»è·ƒ**ï¼šæ–‡æ¡£å®Œå–„ï¼Œæ¡ˆä¾‹å¤š
- **å®Œç¾æ”¯æŒè°ƒç”¨é“¾**ï¼šå¯ä»¥è¿½è¸ª Aâ†’Bâ†’Câ†’D

#### âŒ ç¼ºç‚¹ï¼š
- **åªæ”¯æŒ Java**ï¼šå…¶ä»–è¯­è¨€ç”¨ä¸äº†
- **éœ€è¦å†™ä»£ç **ï¼šæ¯” Semgrep å¤æ‚ä¸€äº›

#### ğŸ’¡ é€‚åˆåœºæ™¯ï¼š
```bash
âœ… å®Œæ•´çš„è°ƒç”¨é“¾åˆ†æï¼ˆä¸Šæ¸¸ä¸‹æ¸¸ï¼‰
âœ… å¤æ‚çš„ä»£ç é‡æ„
âœ… è‡ªå®šä¹‰ä»£ç è´¨é‡æ£€æŸ¥
âœ… ä»£ç ç”Ÿæˆå’Œè½¬æ¢
âœ… æ·±åº¦å®‰å…¨åˆ†æï¼ˆæ±¡ç‚¹è¿½è¸ªï¼‰
```

#### ä½¿ç”¨ç¤ºä¾‹ï¼š
```java
// 5 è¡Œä»£ç æ‰¾åˆ°æ‰€æœ‰æ–¹æ³•è°ƒç”¨
CompilationUnit cu = StaticJavaParser.parse(file);
cu.findAll(MethodCallExpr.class).forEach(call -> {
    System.out.println("è°ƒç”¨äº†: " + call.getNameAsString());
    // å¯ä»¥ç»§ç»­è¿½è¸ªè¿™ä¸ªæ–¹æ³•è°ƒç”¨äº†ä»€ä¹ˆ
});
```

#### ä½ å·²ç»å®ç°çš„åŠŸèƒ½ï¼š
```java
// ä½ çš„ CallChainAnalyzer å·²ç»å®ç°äº†ï¼š
âœ… æŸ¥æ‰¾æ–¹æ³•çš„æ‰€æœ‰è°ƒç”¨è€…ï¼ˆä¸Šæ¸¸ï¼‰
âœ… æŸ¥æ‰¾æ–¹æ³•è°ƒç”¨äº†ä»€ä¹ˆï¼ˆä¸‹æ¸¸ï¼‰
âœ… æ‰¾åˆ°å®Œæ•´çš„è°ƒç”¨é“¾ Aâ†’Bâ†’C
âœ… æ”¯æŒé—´æ¥è°ƒç”¨ï¼ˆé€’å½’è¿½è¸ªï¼‰
```

---

### 3ï¸âƒ£ **Tree-sitter - ç¼–è¾‘å™¨çº§åˆ«çš„è§£æ**

#### âœ… ä¼˜ç‚¹ï¼š
- **è¶…çº§å¿«**ï¼šå¢é‡è§£æï¼Œåªè§£æä¿®æ”¹çš„éƒ¨åˆ†
- **å¤šè¯­è¨€**ï¼š40+ ç§è¯­è¨€ï¼Œç»Ÿä¸€ API
- **éå¸¸ç²¾ç¡®**ï¼šè¯­æ³•æ ‘ç»†èŠ‚ä¸°å¯Œ
- **è¢«å¹¿æ³›ä½¿ç”¨**ï¼šNeovimã€GitHubã€Semgrep éƒ½ç”¨å®ƒ

#### âŒ ç¼ºç‚¹ï¼š
- **å­¦ä¹ æ›²çº¿é™¡å³­**ï¼šéœ€è¦ç†è§£åº•å±‚è¯­æ³•æ ‘
- **éœ€è¦å†™å¤§é‡ä»£ç **ï¼šåšç®€å•çš„äº‹æƒ…ä¹Ÿè¦å¾ˆå¤šä»£ç 
- **API åº•å±‚**ï¼šä¸åƒ JavaParser é‚£ä¹ˆå‹å¥½
- **è°ƒç”¨é“¾éœ€è¦è‡ªå·±å®ç°**ï¼šæ²¡æœ‰ç°æˆçš„å·¥å…·

#### ğŸ’¡ é€‚åˆåœºæ™¯ï¼š
```bash
âœ… å¼€å‘ä»£ç ç¼–è¾‘å™¨ï¼ˆLSP æœåŠ¡å™¨ï¼‰
âœ… è¯­æ³•é«˜äº®
âœ… å¼€å‘é€šç”¨çš„å¤šè¯­è¨€å·¥å…·
âœ… éœ€è¦è¶…é«˜æ€§èƒ½çš„åœºæ™¯
âŒ ä¸é€‚åˆï¼šå¿«é€ŸåŸå‹å¼€å‘ã€ä¸šåŠ¡åˆ†æ
```

#### Tree-sitter åº•å±‚è¾“å‡ºç¤ºä¾‹ï¼š
```
(program
  (class_declaration
    (modifiers)
    name: (identifier)
    body: (class_body
      (method_declaration
        (modifiers)
        type: (type_identifier)
        name: (identifier)
        parameters: (formal_parameters
          (formal_parameter
            type: (type_identifier)
            name: (identifier)))
        body: (block
          (local_variable_declaration
            ...è¶…çº§è¯¦ç»†ä½†å¾ˆåº•å±‚
```

---

## ğŸš€ å®æˆ˜å»ºè®®

### åœºæ™¯1ï¼šå¿«é€Ÿå®‰å…¨æ‰«æ
```bash
ä½¿ç”¨ Semgrep
å‘½ä»¤ï¼šsemgrep --config=p/security-audit src/
æ—¶é—´ï¼šå‡ ç§’é’Ÿ
```

### åœºæ™¯2ï¼šåˆ†ææ–¹æ³•è°ƒç”¨é“¾ï¼ˆä½ çš„éœ€æ±‚ï¼‰â­
```bash
ä½¿ç”¨ JavaParserï¼ˆä½ å·²ç»å®ç°äº†ï¼ï¼‰
å‘½ä»¤ï¼šjava -cp ... CallChainAnalyzer
åŠŸèƒ½ï¼šå®Œæ•´çš„ä¸Šä¸‹æ¸¸è°ƒç”¨é“¾ï¼ŒåŒ…æ‹¬é—´æ¥è°ƒç”¨
```

### åœºæ™¯3ï¼šå¼€å‘å¤šè¯­è¨€åˆ†æå·¥å…·
```bash
ä½¿ç”¨ Tree-sitter
è¯­è¨€ï¼šPython/Rust/C
åœºæ™¯ï¼šéœ€è¦æ”¯æŒå¤šç§è¯­è¨€çš„ç»Ÿä¸€åˆ†æ
```

---

## ğŸ“‹ **ä½ çš„é¡¹ç›®åº”è¯¥ç”¨ä»€ä¹ˆï¼Ÿ**

### âœ… æ¨èç»„åˆï¼š**Semgrep + JavaParser**

```
1. ç¬¬ä¸€æ­¥ï¼šç”¨ Semgrep å¿«é€Ÿæ‰«æ
   â””â”€ æ‰¾å‡ºæ‰€æœ‰å¯ç–‘çš„ä»£ç ä½ç½®
   â””â”€ ç”Ÿæˆå€™é€‰æ¼æ´åˆ—è¡¨

2. ç¬¬äºŒæ­¥ï¼šç”¨ JavaParser æ·±åº¦åˆ†æ
   â””â”€ è¿½è¸ªå®Œæ•´çš„è°ƒç”¨é“¾
   â””â”€ ç¡®è®¤æ˜¯å¦çœŸçš„æœ‰æ¼æ´
   â””â”€ ç”Ÿæˆè¯¦ç»†çš„åˆ†ææŠ¥å‘Š
```

### å®é™…å·¥ä½œæµï¼š

```bash
# Step 1: Semgrep å¿«é€Ÿæ‰«æï¼ˆ5ç§’ï¼‰
semgrep --config=semgrep-idor-rules.yaml src/ > candidates.txt

# Step 2: JavaParser æ·±åº¦åˆ†æï¼ˆ30ç§’ï¼‰
java CallChainAnalyzer --analyze-findings candidates.txt

# è¾“å‡ºï¼š
# - æ¼æ´ç¡®è®¤ï¼ˆçœŸçš„æœ‰é—®é¢˜ï¼‰
# - å®Œæ•´è°ƒç”¨é“¾ï¼ˆæ”»å‡»è·¯å¾„ï¼‰
# - ä¿®å¤å»ºè®®ï¼ˆå¦‚ä½•ä¿®å¤ï¼‰
```

---

## ğŸ“ å­¦ä¹ èµ„æº

### Semgrep
- å®˜æ–¹æ–‡æ¡£: https://semgrep.dev/docs/
- Playground: https://semgrep.dev/playground/
- è§„åˆ™åº“: https://semgrep.dev/r

### JavaParser
- GitHub: https://github.com/javaparser/javaparser
- æ•™ç¨‹: https://javaparser.org/
- ä½ å·²ç»å†™çš„ä»£ç : `CallChainAnalyzer.java` â­

### Tree-sitter
- å®˜ç½‘: https://tree-sitter.github.io/
- Playground: https://tree-sitter.github.io/tree-sitter/playground
- Python ç»‘å®š: `pip install tree-sitter`

---

## ğŸ’¡ æ€»ç»“

| å¦‚æœä½ æƒ³... | ç”¨è¿™ä¸ª |
|------------|--------|
| å¿«é€Ÿæ‰¾æ¼æ´ | Semgrep |
| åˆ†æè°ƒç”¨é“¾ï¼ˆ**ä½ çš„éœ€æ±‚**ï¼‰| **JavaParser** â­ |
| å¼€å‘ç¼–è¾‘å™¨ | Tree-sitter |
| å¤šè¯­è¨€é€šç”¨å·¥å…· | Tree-sitter |
| æœ€ç®€å•ä¸Šæ‰‹ | Semgrep |
| æœ€å¼ºå¤§ï¼ˆJavaï¼‰| JavaParser |
| æœ€å¿«é€Ÿåº¦ | Tree-sitter |

---

## ğŸ¯ ç»™ä½ çš„å»ºè®®

åŸºäºä½ çš„éœ€æ±‚ï¼ˆ**åˆ†ææ–¹æ³•çš„ä¸Šä¸‹æ¸¸è°ƒç”¨é“¾ï¼ŒåŒ…æ‹¬é—´æ¥è°ƒç”¨**ï¼‰ï¼š

### âœ… æœ€ä½³é€‰æ‹©ï¼š**JavaParser**

åŸå› ï¼š
1. âœ… ä½ å·²ç»å®ç°äº† `CallChainAnalyzer.java`
2. âœ… å·²ç»èƒ½è¿½è¸ªå®Œæ•´è°ƒç”¨é“¾
3. âœ… æ”¯æŒé—´æ¥è°ƒç”¨ï¼ˆé€’å½’è¿½è¸ªï¼‰
4. âœ… API å‹å¥½ï¼Œå®¹æ˜“æ‰©å±•
5. âœ… åªéœ€è¦åˆ†æ Java ä»£ç 

### ğŸ”§ ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š

```java
// åœ¨ä½ çš„ CallChainAnalyzer åŸºç¡€ä¸Šæ·»åŠ ï¼š
1. æ±¡ç‚¹åˆ†æï¼ˆè¿½è¸ªç”¨æˆ·è¾“å…¥å¦‚ä½•æµå‘å±é™©å‡½æ•°ï¼‰
2. æ§åˆ¶æµåˆ†æï¼ˆif/else åˆ†æ”¯ï¼‰
3. æ•°æ®æµåˆ†æï¼ˆå˜é‡å¦‚ä½•ä¼ é€’ï¼‰
4. ç”Ÿæˆå¯è§†åŒ–è°ƒç”¨å›¾ï¼ˆGraphVizï¼‰
```

---

**ç»“è®ºï¼šç»§ç»­ç”¨ JavaParser å¼€å‘ï¼Œå®ƒæœ€é€‚åˆä½ çš„éœ€æ±‚ï¼** ğŸš€


