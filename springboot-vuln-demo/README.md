# SpringBoot è¶Šæƒæ¼æ´æ¼”ç¤ºé¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå®‰å…¨æµ‹è¯•çš„ SpringBoot é¡¹ç›®ï¼ŒåŒ…å«å¤šç§è¶Šæƒæ¼æ´ç±»å‹ã€‚

## ğŸš¨ æ¼æ´åˆ—è¡¨

### æ°´å¹³è¶Šæƒï¼ˆHorizontal IDORï¼‰

1. **ç”¨æˆ·ä¿¡æ¯æŸ¥çœ‹è¶Šæƒ** (`GET /api/users/{userId}`)
   - ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯
   - ç¼ºå°‘æˆæƒæ£€æŸ¥

2. **è®¢å•æŸ¥çœ‹è¶Šæƒ** (`GET /api/orders/{orderId}`)
   - å¯ä»¥æŸ¥çœ‹ä»»æ„ç”¨æˆ·çš„è®¢å•è¯¦æƒ…
   - æ²¡æœ‰éªŒè¯è®¢å•æ‰€æœ‰æƒ

3. **è®¢å•ä¿®æ”¹è¶Šæƒ** (`PUT /api/orders/{orderId}`)
   - å¯ä»¥ä¿®æ”¹ä»»æ„ç”¨æˆ·çš„è®¢å•
   - ç¼ºå°‘æ‰€æœ‰æƒéªŒè¯

4. **è®¢å•åˆ é™¤è¶Šæƒ** (`DELETE /api/orders/{orderId}`)
   - å¯ä»¥åˆ é™¤ä»»æ„ç”¨æˆ·çš„è®¢å•
   - æ²¡æœ‰æƒé™æ£€æŸ¥

### å‚ç›´è¶Šæƒï¼ˆVertical Privilege Escalationï¼‰

5. **è§’è‰²ä¿®æ”¹è¶Šæƒ** (`PUT /api/users/{userId}/role`)
   - æ™®é€šç”¨æˆ·å¯ä»¥ä¿®æ”¹å…¶ä»–ç”¨æˆ·çš„è§’è‰²ï¼ˆåŒ…æ‹¬æå‡ä¸ºç®¡ç†å‘˜ï¼‰
   - ç¼ºå°‘ç®¡ç†å‘˜æƒé™æ£€æŸ¥

6. **ç®¡ç†å‘˜åŠŸèƒ½è®¿é—®** (`GET /api/users/admin/all`)
   - æ™®é€šç”¨æˆ·å¯ä»¥è®¿é—®ç®¡ç†å‘˜ä¸“ç”¨åŠŸèƒ½
   - æ²¡æœ‰è§’è‰²éªŒè¯

7. **ç»Ÿè®¡ä¿¡æ¯è®¿é—®** (`GET /api/orders/admin/stats`)
   - æ™®é€šç”¨æˆ·å¯ä»¥æŸ¥çœ‹ç®¡ç†å‘˜ç»Ÿè®¡ä¿¡æ¯
   - ç¼ºå°‘æƒé™æ§åˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯åŠ¨åº”ç”¨

```bash
mvn spring-boot:run
```

åº”ç”¨å°†åœ¨ `http://localhost:8080` å¯åŠ¨

### æµ‹è¯•æ•°æ®

åº”ç”¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼š

- **ç®¡ç†å‘˜ç”¨æˆ·**
  - ID: 1
  - Username: admin
  - Password: admin123
  - Role: ADMIN

- **æ™®é€šç”¨æˆ·1**
  - ID: 2
  - Username: alice
  - Password: alice123
  - Role: USER
  - è®¢å•: order1 (id=1), order2 (id=2)

- **æ™®é€šç”¨æˆ·2**
  - ID: 3
  - Username: bob
  - Password: bob123
  - Role: USER
  - è®¢å•: order3 (id=3), order4 (id=4)

## ğŸ§ª æ¼æ´æµ‹è¯•ç¤ºä¾‹

### æ°´å¹³è¶Šæƒæµ‹è¯•

```bash
# ç”¨æˆ· alice (ID=2) å°è¯•æŸ¥çœ‹ç”¨æˆ· bob (ID=3) çš„ä¿¡æ¯
curl -H "X-User-Id: 2" http://localhost:8080/api/users/3

# ç”¨æˆ· alice å°è¯•æŸ¥çœ‹ bob çš„è®¢å•
curl -H "X-User-Id: 2" http://localhost:8080/api/orders/3

# ç”¨æˆ· alice å°è¯•ä¿®æ”¹ bob çš„è®¢å•
curl -X PUT -H "X-User-Id: 2" -H "Content-Type: application/json" \
  -d '{"status":"CANCELLED"}' \
  http://localhost:8080/api/orders/3
```

### å‚ç›´è¶Šæƒæµ‹è¯•

```bash
# æ™®é€šç”¨æˆ· alice å°è¯•å°†è‡ªå·±æå‡ä¸ºç®¡ç†å‘˜
curl -X PUT -H "X-User-Id: 2" \
  "http://localhost:8080/api/users/2/role?newRole=ADMIN"

# æ™®é€šç”¨æˆ·å°è¯•è®¿é—®ç®¡ç†å‘˜åŠŸèƒ½
curl -H "X-User-Id: 2" http://localhost:8080/api/users/admin/all

# æ™®é€šç”¨æˆ·å°è¯•æŸ¥çœ‹ç®¡ç†å‘˜ç»Ÿè®¡
curl -H "X-User-Id: 2" http://localhost:8080/api/orders/admin/stats
```

## ğŸ” ä½¿ç”¨ Strix è¿›è¡Œå®‰å…¨æµ‹è¯•

```bash
# ç™½ç›’æµ‹è¯•ï¼ˆåˆ†ææºç ï¼‰
strix --target ./springboot-vuln-demo \
  --instruction "é‡ç‚¹æ£€æµ‹æ°´å¹³è¶Šæƒå’Œå‚ç›´è¶Šæƒé—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªSpringBootåº”ç”¨ï¼Œä½¿ç”¨X-User-Id headerè¿›è¡Œç”¨æˆ·èº«ä»½è¯†åˆ«ï¼Œä½†ç¼ºå°‘æˆæƒæ£€æŸ¥ã€‚"

# ç°ç›’æµ‹è¯•ï¼ˆæºç  + è¿è¡Œä¸­çš„åº”ç”¨ï¼‰
strix --target ./springboot-vuln-demo \
  --target http://localhost:8080 \
  --instruction "æ£€æµ‹IDORå’Œæƒé™æå‡æ¼æ´ã€‚åº”ç”¨ä½¿ç”¨X-User-Id headeræ ‡è¯†ç”¨æˆ·ï¼Œä½†APIç«¯ç‚¹ç¼ºå°‘æˆæƒéªŒè¯ã€‚"
```

## ğŸ“ API ç«¯ç‚¹åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | æè¿° | æ¼æ´ç±»å‹ |
|------|------|------|----------|
| GET | `/api/users/{userId}` | è·å–ç”¨æˆ·ä¿¡æ¯ | æ°´å¹³è¶Šæƒ |
| PUT | `/api/users/{userId}/role` | ä¿®æ”¹ç”¨æˆ·è§’è‰² | å‚ç›´è¶Šæƒ |
| GET | `/api/users/admin/all` | è·å–æ‰€æœ‰ç”¨æˆ· | å‚ç›´è¶Šæƒ |
| GET | `/api/orders/{orderId}` | è·å–è®¢å•è¯¦æƒ… | æ°´å¹³è¶Šæƒ |
| PUT | `/api/orders/{orderId}` | æ›´æ–°è®¢å• | æ°´å¹³è¶Šæƒ |
| DELETE | `/api/orders/{orderId}` | åˆ é™¤è®¢å• | æ°´å¹³è¶Šæƒ |
| GET | `/api/orders/admin/stats` | è·å–è®¢å•ç»Ÿè®¡ | å‚ç›´è¶Šæƒ |

## âš ï¸ å®‰å…¨è¯´æ˜

**è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå®‰å…¨æµ‹è¯•çš„æ¼”ç¤ºé¡¹ç›®ï¼ŒåŒ…å«æ•…æ„è®¾è®¡çš„å®‰å…¨æ¼æ´ã€‚**
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
- ä¸è¦ç”¨äºçœŸå®ä¸šåŠ¡åœºæ™¯
- ä»…ç”¨äºå®‰å…¨ç ”ç©¶å’Œæµ‹è¯•

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- Spring Boot 3.2.0
- Spring Data JPA
- H2 Database (å†…å­˜æ•°æ®åº“)
- Java 17

